<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>React App</title>
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0aed7cff3e69be6d99e79138ccf791f5"></script>
</head>

<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root"></div>
  <div class="defaults"></div>
  <div class="mask">LOADING...</div>

  <style>
    .defaults {
      position: absolute;
      top: -99999px;
    }

    .mask {
      width: 100%;
      height: 100vh;
      background: #111;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 11;
      opacity: 1;
      transition: opacity 2s;
      display: flex;
      justify-content: center;
      align-items: center;
      font: 20px/1 'arial';
      color: #fff;
    }
  </style>

  <script>
    /*
    이미지, 영상소스를 미리 SSR방식으로 캐싱처리하는 작업흐름
    1. 배열에 캐싱할 이미지와 영상소스의 URL을 미리 담아놓음
    2. 동적으로 배열에 있는 정보값으로 실제 img, video 돔을 index.html안쪽에 강제 생성
    3. DOM이 index.html에 생성되는 동안 마스크화면을 대신 보여줌
    4. 모든 영상, 이미지 소스가 캐싱완료되면 마스크를 강제 제거하고 동적으로 생성한 요소도 제거
    5. 그 사이 리액트 컴포넌트들이 리얼돔으로 변환되서 화면에 출력
    */
    const defaults = document.querySelector('.defaults');
    const mask = document.querySelector('.mask');
    let tags = '';
    const baseURL = 'https://dcodelabTutor.github.io/react_9class/img/';
    const imgs = [
      baseURL + 'Community.jpg',
      baseURL + 'Department.jpg',
      baseURL + 'Gallery.jpg',
      baseURL + 'Location.jpg',
      baseURL + 'Youtube.jpg',
      baseURL + 'Member.jpg',
    ];
    const vids = [
      baseURL + 'vid2.mp4'
    ];

    function createDOM() {
      imgs.forEach(src => tags += `<img src=${src} />`);
      vids.forEach(src => tags += `<video src=${src}></video>`);
      defaults.innerHTML = tags;
    }

    //이미지소스 로딩완료체크 함수
    function loadImg() {
      return new Promise((res, rej) => {
        let countImg = 0;
        const imgDOM = defaults.querySelectorAll('img');

        imgDOM.forEach(img => {
          img.onload = () => {
            countImg++;
            console.log('img loaded', countImg);
            if (countImg === imgs.length) res(true);
          }
        })
      })
    }

    //영상소스 로딩완료체크 함수
    function loadVid() {
      return new Promise((res, rej) => {
        let countVid = 0;
        const vidDOM = defaults.querySelectorAll('video');

        vidDOM.forEach(vid => {
          vid.onloadeddata = () => {
            countVid++;
            console.log('vid loaded', countVid);
            if (countVid === vids.length) res(true);
          }
        })
      })
    }
    createDOM();
  </script>


  <!-- 
    SSR vs CSR
    - SSR (Server Side Rendering) : 페이지 이동시 일일이 HTML파일을 서버로부터 불러오는 방식
    - CSR (Client Side Rendering) : 초기 페이지로딩시 모든 컴포넌트 (JSX) 파일을 한번에 모두 불러오는 방식

    SSR
    - 장점: 초기로딩속도 빠름, SEO 좋음
    - 단점: 페이지 이동시마다 일일이 서버쪽에서 HTML파일을 요청하기 때문에 사용성이 안좋음

    CSR
    - 장점: 모든 컴포넌트 파일을 초기에 모두 가져오기 때문에 페이지 이동시 페이지전환 로딩이 없음
    - 단점: 초기로딩속도가 김, SEO에 취약

    기본적으로 리액트는 CSR방식이기 때문에 초기로딩속도와 검색엔진 최적화에 취약
    -- 위화같은 문제점을 해결하기위해서 초기데이터 로딩시에는 SSR방식으로 이후 모든 리액트 컴포넌트가 불러와지면 CSR방식으로 바꿔치지 하는 SSR과 CSR 방식의 혼합 형태로 웹 개발
   -->
</body>

</html>